!function i(r,s,u){function a(n,e){if(!s[n]){if(!r[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(c)return c(n,!0);throw new Error("Cannot find module '"+n+"'")}var o=s[n]={exports:{}};r[n][0].call(o.exports,function(e){var t=r[n][1][e];return a(t||e)},o,o.exports,i,r,s,u)}return s[n].exports}for(var c="function"==typeof require&&require,e=0;e<u.length;e++)a(u[e]);return a}({1:[function(e,t,n){"use strict";n.__esModule=!0;n.DeviceCookieID="SMM_device_id";n.TokenCookieID="SMM_auth_token";n.SessionCookieID="SMM_session_id";n.SessionStartTimeCookieID="SMM_session_start_timestamp";n.MetalCookieDomin=".metal.com";n.MMIPriceCookieDomin=".mmiprices.com"},{}],2:[function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});n.__esModule=!0;var r=e("./frame"),p=e("../utils/env"),v=e("@smm/uuid"),_=e("./plugins/device"),d=e("./plugins/session"),h=e("./result_fn/device"),y=e("./result_fn/time"),k=e("./result_fn/token"),w=e("./result_fn/session"),D=e("./result_fn/app_id"),M=e("./result_fn/path"),I=e("./result_fn/referrer"),S=e("./result_fn/domain"),g=e("./result_fn/query"),C=e("./result_fn/scheme"),K=function(r){function e(e,t){var n=r.call(this,e)||this;n.events=[];for(var o=0,i=t;o<i.length;o++){i[o].Inject()}return n}return i(e,r),e.prototype.setCommon=function(e){this.common=e},e.prototype.setFlow=function(e){this.events.push(e)},e.prototype.setFlows=function(e){this.events=e},e.prototype.parse=function(){return this.parse_common(this.common,this.events)},e.prototype.parse_common=function(e,t){var n={};for(var o in e)n[o]=e[o]();for(var i=[],r=0;r<(t&&t.length);r++){var s=t[r],u={};for(var o in s)u[o]=s[o]();i.push(u)}return n.flow=i,n},e.prototype.send_log_events=function(e,t){this.ajax({type:"POST",url:e||this.event_url(),contentType:"application/json",dataType:"json",data:JSON.stringify(this.parse()),success:function(){t&&t()}})},e}(r.Frame),s=new(n.Sa=K)(p.IsDev(),[_.DefaultDevicePlugin,d.DefaultSessionPlugin]);n.DefaultSa=s;for(var u={},a=0,c=[k.tokenKV,w.sessionidKV,w.sessionstartidKV,y.timeKV,h.deviceKV,D.appIdKV];a<c.length;a++){u[(V=c[a]).name]=V.value}s.setCommon(u);for(var f={},l=0,m=[{name:"flow_id",value:v.UUID.Generate},{name:"flow_type",value:function(){return"f"}},{name:"timestamp",value:y.time},C.schemeKV,M.pathKV,g.queryKV,S.domainKV,I.referrerKV];l<m.length;l++){var V;f[(V=m[l]).name]=V.value}s.setFlow(f),window.define||(window.smm_spider=K,window.smm_default_spider=function(){s.send_log_events()});var T,O,P=function(e,t,n,o){for(var i=new K(p.IsDev(),[_.DefaultDevicePlugin,d.DefaultSessionPlugin]),r={},s=0,u=[k.tokenKV,w.sessionidKV,w.sessionstartidKV,y.timeKV,h.deviceKV,D.appIdKV];s<u.length;s++){r[(m=u[s]).name]=m.value}i.setCommon(r);var a={},c=[{name:"flow_id",value:v.UUID.Generate},{name:"flow_type",value:function(){return e}},{name:"timestamp",value:y.time},C.schemeKV,M.pathKV,g.queryKV,S.domainKV,I.referrerKV];/^e{1}$/i.test(e)&&(n&&c.push({name:"event_type_id",value:function(){return n}}),o&&c.push({name:"data",value:function(){return o}}));for(var f=0,l=c;f<l.length;f++){var m;a[(m=l[f]).name]=m.value}i.setFlow(a),i.send_log_events(void 0,t)};n.DefinedSa=P,(O=T||(T={})).click="click",O.mouseenter="mouseenter",O.mouseover="mouseover",O.mouseout="mouseout",O.unblur="unblur",O.change="change",O.hover="hover",n.EventType=T;var b=function(e){if("[object Array]"===Object.prototype.toString.call(e.className))for(var t=e.className,n=0;n<t.length;n++)j(e);else j(e)};n.ClassDefinedSa=b;var j=function(e){var t=e.className;document.querySelector(t).addEventListener(e.eventType,function(){P(e.flow_type,e.cb,e.event_type_id,e.data)})};window.smm_defined_spider=P,window.ClassEventDefinedSa=b},{"../utils/env":18,"./frame":3,"./plugins/device":4,"./plugins/session":5,"./result_fn/app_id":6,"./result_fn/device":7,"./result_fn/domain":8,"./result_fn/path":10,"./result_fn/query":11,"./result_fn/referrer":12,"./result_fn/scheme":13,"./result_fn/session":14,"./result_fn/time":15,"./result_fn/token":16,"@smm/uuid":20}],3:[function(e,t,n){"use strict";n.__esModule=!0;var o=function(){function e(e){this.isdev=e}return e.prototype.host=function(){return this.isdev?"https://testplatform.smm.cn":"https://platform.smm.cn"},e.prototype.event_url=function(){return this.host()+"/collectioncenter/log_event"},e.prototype.device_url=function(){return this.host()+"/collectioncenter/log_device"},e.prototype.ajax=function(e){var t={type:e.type||"GET",url:e.url||"",async:e.async||"true",data:e.data||null,dataType:e.dataType||"text",contentType:e.contentType||"application/x-www-form-urlencoded",beforeSend:e.beforeSend||function(){},success:e.success||function(){},error:e.error||function(){}};t.beforeSend();var n=new XMLHttpRequest;n.responseType=t.dataType,n.open(t.type,t.url,t.async),n.setRequestHeader("Content-Type",t.contentType),n.send(this.convertData(t.data)),n.onreadystatechange=function(){4==n.readyState&&(200==n.status?t.success(n.response):t.error())}},e.prototype.convertData=function(e){if("object"!=typeof e)return e;var t="";for(var n in e)t+=n+"="+e[n]+"&";return t=t.substring(0,t.length-1)},e}();n.Frame=o},{}],4:[function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});n.__esModule=!0;var r=e("@smm/uuid"),u=e("@smm/cookie"),a=e("../../utils/env"),s=e("../frame"),c=e("../const"),f=e("../result_fn/device"),l=e("../result_fn/height"),m=e("../result_fn/width"),p=function(s){function e(e,t){var n=s.call(this,e)||this;n.common={};for(var o=0,i=t;o<i.length;o++){var r=i[o];n.common[r.name]=r.value}return n}return i(e,s),e.prototype.log_device=function(e){this.ajax({type:"POST",url:e||this.device_url(),contentType:"application/json",dataType:"json",data:JSON.stringify(this.parse(this.common))})},e.prototype.parse=function(e){var t={};for(var n in e)t[n]=e[n]();return t},e.prototype.Inject=function(){if(!u.Cookie.Get(c.DeviceCookieID)){var e=r.UUID.Generate();a.IsMetal()?u.Cookie.Set(c.DeviceCookieID,e,3650,c.MetalCookieDomin):a.IsMMIPrice()?u.Cookie.Set(c.DeviceCookieID,e,3650,c.MMIPriceCookieDomin):u.Cookie.Set(c.DeviceCookieID,e,3650),this.log_device()}},e}(s.Frame),v=new(n.Device=p)(a.IsDev(),[f.deviceKV,m.widthKV,l.heightKV]);n.DefaultDevicePlugin=v},{"../../utils/env":18,"../const":1,"../frame":3,"../result_fn/device":7,"../result_fn/height":9,"../result_fn/width":17,"@smm/cookie":19,"@smm/uuid":20}],5:[function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});n.__esModule=!0;var r=e("@smm/uuid"),s=e("@smm/cookie"),u=e("../../utils/env"),a=e("../frame"),c=e("../const"),f=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.Inject=function(){this._init(),this._event()},e.prototype._init=function(){var e=s.Cookie.Get(c.SessionCookieID)||r.UUID.Generate(),t=new Date,n=s.Cookie.Get(c.SessionStartTimeCookieID)||String(t.getTime());u.IsMetal()?this._cookieSet(e,n,c.MetalCookieDomin):u.IsMMIPrice()?this._cookieSet(e,n,c.MMIPriceCookieDomin):this._cookieSet(e,n)},e.prototype._cookieSet=function(e,t,n){s.Cookie.Set(c.SessionCookieID,e,1/48,n||s.Cookie.DOMAIN),s.Cookie.Set(c.SessionStartTimeCookieID,t,1/48,n||s.Cookie.DOMAIN)},e.prototype._event=function(){var t=this,n=!1;["click","mouseover","keydown"].forEach(function(e){document.addEventListener(e,function(){n||(n=!0,t._init(),setTimeout(function(){n=!1},1e3))})})},e}(a.Frame),l=new(n.Session=f)(u.IsDev());n.DefaultSessionPlugin=l},{"../../utils/env":18,"../const":1,"../frame":3,"@smm/cookie":19,"@smm/uuid":20}],6:[function(e,t,n){"use strict";function o(){return 1}n.__esModule=!0;var i={name:"app_id",value:n.AppID=o};n.appIdKV=i},{}],7:[function(e,t,n){"use strict";n.__esModule=!0;var o=e("@smm/cookie"),i=e("../const");function r(){return o.Cookie.Get(i.DeviceCookieID)}var s={name:"device_id",value:n.device=r};n.deviceKV=s},{"../const":1,"@smm/cookie":19}],8:[function(e,t,n){"use strict";function o(){return window.location.host}n.__esModule=!0;var i={name:"domain",value:n.domain=o};n.domainKV=i},{}],9:[function(e,t,n){"use strict";function o(){return window.innerHeight}n.__esModule=!0;var i={name:"height",value:n.height=o};n.heightKV=i},{}],10:[function(e,t,n){"use strict";function o(){return window.location.pathname}n.__esModule=!0;var i={name:"path",value:n.path=o};n.pathKV=i},{}],11:[function(e,t,n){"use strict";function o(){return window.location.search.substr(1)||""}n.__esModule=!0;var i={name:"query",value:n.query=o};n.queryKV=i},{}],12:[function(e,t,n){"use strict";function o(){return document.referrer}n.__esModule=!0;var i={name:"referrer",value:n.referrer=o};n.referrerKV=i},{}],13:[function(e,t,n){"use strict";function o(){return window.location.protocol}n.__esModule=!0;var i={name:"scheme",value:n.scheme=o};n.schemeKV=i},{}],14:[function(e,t,n){"use strict";n.__esModule=!0;var o=e("@smm/cookie"),i=e("../const");function r(){return o.Cookie.Get(i.SessionCookieID)}function s(){return Number(o.Cookie.Get(i.SessionStartTimeCookieID))}n.session_id=r,n.session_start_id=s;var u={name:"session_id",value:r};n.sessionidKV=u;var a={name:"session_start_timestamp",value:s};n.sessionstartidKV=a},{"../const":1,"@smm/cookie":19}],15:[function(e,t,n){"use strict";function o(){return(new Date).getTime()}n.__esModule=!0;var i={name:"upload_timestamp",value:n.time=o};n.timeKV=i},{}],16:[function(e,t,n){"use strict";n.__esModule=!0;var o=e("@smm/cookie"),i=e("../const");function r(){return o.Cookie.Get(i.TokenCookieID)}var s={name:"token",value:n.token=r};n.tokenKV=s},{"../const":1,"@smm/cookie":19}],17:[function(e,t,n){"use strict";function o(){return window.innerWidth}n.__esModule=!0;var i={name:"width",value:n.width=o};n.widthKV=i},{}],18:[function(e,t,n){"use strict";n.__esModule=!0,n.IsDev=function(){return-1!==window.location.host.indexOf("test")},n.IsMetal=function(){return-1!==window.location.host.indexOf("metal.com")},n.IsMMIPrice=function(){return-1!==window.location.host.indexOf("mmiprices.com")}},{}],19:[function(e,t,n){"use strict";n.__esModule=!0;var o=function(){function u(){}return u.Set=function(e,t,n,o,i){if(void 0===n&&(n=1),e){var r=e+"="+encodeURIComponent(t),s=new Date;s.setTime(s.getTime()+24*n*60*60*1e3),r+=";expires="+s.toUTCString(),r+=";domain="+(o||u.DOMAIN),r+=";path="+(i||u.PATH),document.cookie=r}},u.Get=function(e){var t=new RegExp("(^| )"+e+"=([^;]*)(;|$)"),n=document.cookie.match(t);return n?n[2]:null},u.PATH="/",u.DOMAIN=".smm.cn",u.DefaultKey="SMM_auth_token",u}();n.Cookie=o},{}],20:[function(e,t,n){"use strict";n.__esModule=!0;var o=function(){function n(){}return n.Generate=function(){for(var e=[],t=0;t<36;t++)e[t]=n.HEX.substr(Math.floor(16*Math.random()),1);return e[14]="5",e[19]=n.HEX.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")},n.HEX="0123456789abcdef",n}();n.UUID=o},{}]},{},[2]);